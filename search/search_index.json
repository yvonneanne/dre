{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"index.html","title":"Repo description","text":"<p>This repo holds the tools and documentation for IC Decentralized Reliability Engineering (DRE). We manage the IC Mainnet, topology, observability and monitoring.</p>"},{"location":"getting-started.html","title":"Getting Started","text":""},{"location":"getting-started.html#downloading-the-pre-built-binary","title":"Downloading the pre-built binary","text":"<p>These instructions are for a Linux based system. We tested on Ubuntu 22.04.</p> <pre><code>mkdir -p $HOME/bin\ncurl -L https://github.com/dfinity/dre/releases/download/v0.2.0/dre -o $HOME/bin/dre\nchmod +x $HOME/bin/dre\n</code></pre> <p>Make sure that <code>$HOME/bin</code> is added to your path. If it's not, you might get an error such as: <pre><code>\u276f dre\nCommand 'dre' not found, did you mean:\n[...]\n</code></pre></p> <p>To fix this issue, you can run <pre><code>export PATH=$HOME/bin:$PATH\n</code></pre></p> <p>And you can also add this to your $HOME/.bashrc file (or the one appropriate for your shell).</p>"},{"location":"how-to-update-docs.html","title":"Documentation","text":"<p>We use MkDocs to generate, serve, and search the team documentation. For full documentation visit mkdocs.org.</p>"},{"location":"how-to-update-docs.html#commands","title":"Commands","text":"<ul> <li><code>bazel run \"//:mkdocs\" new [dir-name]</code> - Create a new project.</li> <li><code>bazel run \"//:mkdocs\" serve</code> - Start the live-reloading docs server.</li> <li><code>bazel run \"//:mkdocs\" build</code> - Build the documentation site.</li> <li><code>bazel run \"//:mkdocs\" -h</code> - Print help message and exit.</li> </ul> <p>To generate documentation as HTML, you can use convenience script <code>./bin/mkdocs-build.sh</code>. The generated documentation will be in the <code>site</code> subdirectory of the repo root.</p>"},{"location":"how-to-update-docs.html#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"nns-proposals.html","title":"NNS/ic-admin operations","text":"<p>Most of the commands here can be run in multiple ways. Currently we are putting in the effort to make <code>dre</code> as useful as possible. As such it provides support for <code>dry_run</code> as default and that can be highly beneficial in most scenarios (for eg. if someone is asking you to submit a proposal for them the best practice way is to run a <code>dry_run</code> and ask them to double check the command and the payload that would be submitted) and that is why we recommend using <code>dre</code> whenever possible. In some use-cases <code>dre</code> cannot help you, and that is when you should use whatever tool/script is at hand.</p>"},{"location":"nns-proposals.html#get-the-principal-from-your-hsm","title":"Get the principal from your HSM","text":"<pre><code>\u276f dfx identity use hsm\nUsing identity: \"hsm\".\n\u276f export DFX_HSM_PIN=$(cat ~/.hsm-pin)\n\u276f dfx identity get-principal\nas4rt-t4nqh-64j36-ubyaa-2c6uz-f2qbm-67llh-ftd3y-epn2e-wzaut-wae\n</code></pre>"},{"location":"nns-proposals.html#get-the-neuron-id-associated-with-your-hsm","title":"Get the neuron id associated with your HSM","text":"<pre><code>\u276f export DFX_HSM_PIN=$(cat ~/.hsm-pin)\n\u276f dfx canister --identity=hsm --network=ic call rrkah-fqaaa-aaaaa-aaaaq-cai get_neuron_ids '()'\n(vec { 40 : nat64 })\n</code></pre>"},{"location":"nns-proposals.html#getting-the-mainnet-firewall-rules","title":"Getting the Mainnet firewall rules","text":"<pre><code>dre get firewall-rules replica_nodes | jq\n</code></pre>"},{"location":"nns-proposals.html#get-the-node-rewards-table-used-for-the-node-provider-compensation","title":"Get the Node Rewards Table, used for the Node Provider compensation","text":"<pre><code>ic-admin --nns-url https://ic0.app get-node-rewards-table\n{\n  \"table\": {\n    \"Asia\": {\n[...]\n}\n</code></pre> <ul> <li>Alternative</li> </ul> <pre><code>dre get node-rewards-table\n</code></pre>"},{"location":"nns-proposals.html#update-the-node-rewards-table","title":"Update the Node Rewards Table","text":"<pre><code>ic-admin --nns-url https://ic0.app --use-hsm --pin $(cat ~/.hsm-pin) --key-id 01 --slot 0 propose-to-update-node-rewards-table --proposer $PROPOSER_NEURON_INDEX --summary-file 2022-12-type3.md --updated-node-rewards \"$(cat 2022-12-type3-rewards.json)\"\n</code></pre> <ul> <li>Alternative</li> </ul> <pre><code>dre propose update-node-rewards-table --summary-file 2022-12-type3.md --updated-node-rewards \"$(cat 2022-12-type3-rewards.json | jq -c)\"\n</code></pre>"},{"location":"nns-proposals.html#enable-the-https-outcalls-on-a-subnet","title":"Enable the HTTPs outcalls on a subnet","text":"<pre><code>cargo run --bin ic-admin -- --nns-url https://ic0.app/ \\    \n    --use-hsm \\\n    --pin $(cat ~/.hsm-pin) \\\n    --key-id 01 \\\n    --slot 0 \\\n    propose-to-update-subnet \\\n    --proposer  &lt;neuron&gt;  \\\n    --features \"http_requests\" \\\n    --subnet uzr34-akd3s-xrdag-3ql62-ocgoh-ld2ao-tamcv-54e7j-krwgb-2gm4z-oqe \\\n    --summary \"Enable the HTTPS outcalls feature on the non-whitelisted uzr34 subnet so that the exchange rate canister can query exchange rate data.\"\n</code></pre> <ul> <li>Alternative</li> </ul> <pre><code>dre propose update-subnet \\\n    --features \"http_requests\" \\\n    --subnet uzr34-akd3s-xrdag-3ql62-ocgoh-ld2ao-tamcv-54e7j-krwgb-2gm4z-oqe \\\n    --summary \"Enable the HTTPS outcalls feature on the non-whitelisted uzr34 subnet so that the exchange rate canister can query exchange rate data.\"\n</code></pre>"},{"location":"nns-proposals.html#removing-node-operator-principal-id","title":"Removing node operator principal id","text":"<pre><code>dre propose remove-node-operators kdqam-hauon-sdvym-42eyg-5wyff-4ywbw-v6iij-2sw2z-bu4rj-ejusn-jae \\\n    --summary \"&lt;An appropriate summary for the proposal, and a link to the forum post for further discussion, if possible&gt;\"\n</code></pre>"},{"location":"nns-proposals.html#removing-nodes-from-the-registry","title":"Removing nodes from the registry","text":"<p>Here is an example where we remove all AW1 nodes for redeployment.</p> <pre><code>dre nodes remove aw1 --motivation \"Removing AW1 nodes for redeployment\"\n</code></pre>"},{"location":"bazel/tips-and-tricks.html","title":"Tips and tricks","text":"Refresh Python dependencies in Bazel <p>Steps: 1. <code>poetry add &lt;dependency&gt;</code> 2. Run <code>./bin/poetry-export.sh</code> 3. Use regular bazel operations, the new dependency should now be available</p>"},{"location":"trustworthy-metrics/architecture.html","title":"Trustworthy Node Metrics: Architectural Overview and Design","text":""},{"location":"trustworthy-metrics/architecture.html#introduction","title":"Introduction","text":"<p>This document offers a deeper look at the architectural design of the Trustworthy Node Metrics feature on the Internet Computer (IC). It is tailored for IC stakeholders and technical professionals, providing a detailed understanding of both the functional and structural aspects.</p>"},{"location":"trustworthy-metrics/architecture.html#objectives","title":"Objectives","text":"<p>The primary goal is to provide clear visibility into the useful work carried out by nodes on the IC. This transparency is a foundational step towards a future feature that will enable the adjustment of node remuneration based on their operational performance and reliability.</p>"},{"location":"trustworthy-metrics/architecture.html#high-level-architectural-changes","title":"High-Level Architectural Changes","text":"<p>On a high level, planned architectural changes are illustrated in the following figure:</p> <p></p>"},{"location":"trustworthy-metrics/architecture.html#integration-with-existing-architecture","title":"Integration with Existing Architecture","text":"<p>The feature is designed to integrate seamlessly with the existing IC infrastructure. The changes primarily involve the Consensus Layer, Message Routing Layer, and the addition of new components to handle metric aggregation and retrieval.</p>"},{"location":"trustworthy-metrics/architecture.html#expose-already-existing-information-to-end-users","title":"Expose already existing information to end users","text":"<p>Consensus Layer to expose block maker information, which will be collected and aggregated by the Message Routing Layer, and stored in the replicated state with success and failure metrics of nodes. - The metrics for the number of successfully proposed blocks and failures thereof are accumulated in the replicated state for node IDs.\u00a0 - The state of this accumulation is saved as a snapshot including the last batch just before midnight in a queue of snapshots (in chronologically ascending order). - Snapshots in the queue are immutable, i.e. the current state is not included. - There is no guarantee that the snapshots represent whole days or that all days are included since the subnet could have been offline at some point.\u00a0</p>"},{"location":"trustworthy-metrics/architecture.html#data-accessibility","title":"Data Accessibility","text":"<p>The inclusion of new components to ensure that the metrics are easily accessible for analysis and decision-making processes. This involves the management canister playing a crucial role in fetching and providing these metrics to stakeholders.</p> <ul> <li> <p>A metrics-fetching function is added to the management canister</p> </li> <li> <p>There is support for querying since particular date</p> </li> <li> <p>The function will return data from the replicated state.</p> </li> <li> <p>See https://github.com/dfinity/interface-spec/pull/215 for more details.</p> </li> </ul> <p>The DRE team provided open source tooling that fetches the metrics from the management canister(s) of all subnets and allows the community members to inspect the metrics in details.</p> <ul> <li> <p>The metrics retrieved from the IC can be stored in a local file (JSON format), and then further analyzed</p> </li> <li> <p>The metrics will be retrieved from all subnets in parallel, whenever possible, to reduce the amount of time needed to fetch them, taking into account the possible increase of the number of subnets in the future.</p> </li> <li> <p>See trustworthy-metrics</p> </li> </ul>"},{"location":"trustworthy-metrics/architecture.html#detailed-architectural-diagrams-and-data-flow","title":"Detailed Architectural Diagrams and Data Flow","text":"<p>The high-level and in-depth technical diagrams provide a visual representation of the data flow within the IC architecture with to the implementation of the Trustworthy Node Metrics feature.</p> <pre><code>graph TD\n    subgraph \"IC Community\"\n        F[\"Community Members\\n[verify metrics]\"] --&gt;T[DRE Tooling]\n        F --&gt; H[Data Analysis Tools]\n        H --&gt; J[JSON data with metrics]\n        J --&gt; I[Community Insight and Verification of Node Performance]\n    end\n    subgraph Sx[\"IC subnet X\"]\n        T &lt;----&gt; W\n        W[Wallet Canister]\n        W &lt;-..-&gt;|fetch data| D1\n        A1[Consensus Layer] --&gt;|Exposes block maker information| B1[\"Message Routing (MR) Layer\"]\n        B1 --&gt;|Aggregates and writes| C1(((Replicated State)))\n        D1[Management Canister] --&gt;|Trustworthy metrics API| C1\n    end\n    subgraph Sy[\"IC subnet Y\"]\n        W &lt;-.....-&gt;|\"Fetch data with\\ncross-subnet (XNet) calls\"| D2\n        A2[Consensus Layer] --&gt;|Exposes block maker information| B2[\"Message Routing (MR) Layer\"]\n        B2 --&gt;|Aggregates and writes| C2(((Replicated State)))\n        D2[Management Canister] --&gt;|Trustworthy metrics API| C2\n    end\n    subgraph Sz[\"IC subnet Z\"]\n        W &lt;-.....-&gt;|\"Fetch data with\\ncross-subnet (XNet) calls\"| D3\n        A3[Consensus Layer] --&gt;|Exposes block maker information| B3[\"Message Routing (MR) Layer\"]\n        B3 --&gt;|Aggregates and writes| C3(((Replicated State)))\n        D3[Management Canister] --&gt;|Trustworthy metrics API| C3\n    end</code></pre> <p>Link for online editing with preview</p>"},{"location":"trustworthy-metrics/architecture.html#changes-in-the-public-specification","title":"Changes in the Public Specification","text":"<p>Addition of the <code>node_metrics</code> Interface: This involves updating the existing public spec to include a new <code>node_metrics</code> interface that will provide detailed metrics about node performance.</p> <p>This new interface is marked as experimental, which means that end users should not count on it being permanently being present without changes.</p>"},{"location":"trustworthy-metrics/architecture.html#security-and-reliability-considerations","title":"Security and Reliability Considerations","text":"<p>The feature requires the use of a wallet canister, in order to prevent abuse. Each request for fetching metrics will be charged for, which makes it harder for malicious users to conduct DOS attacks using this interface.</p> <p>All data is retrieved through <code>update</code> calls, in order to prevent a potentially malicious node from providing false data.</p>"},{"location":"trustworthy-metrics/architecture.html#conclusion","title":"Conclusion","text":"<p>The Trustworthy Node Metrics feature enables the next milestone in the transparency and operational efficiency of the IC. By providing clear insights into node performance, it lays the groundwork for decentralized data-driven decision making, and for future enhancements in node remuneration processes.</p>"},{"location":"trustworthy-metrics/trustworthy-metrics.html","title":"Get trustworthy metrics from the IC Mainnet","text":""},{"location":"trustworthy-metrics/trustworthy-metrics.html#introduction-and-prerequisites","title":"Introduction and prerequisites","text":"<p>To be able to fetch trustworthy metrics there are a couple of things needed prior to running this extension:</p> <ol> <li> <p>You need a dfx principal. If needed you can create a new one with</p> <pre><code># You can use the one from your HSM but there are some caveats to that that will be addressed later\ndfx identity new &lt;identity-name&gt;\n</code></pre> <p>or follow instructions from the IC SDK Docs</p> </li> <li> <p>You can list available dfx identities with <code>dfx identity list</code> and then need to select that identity and get its principal.</p> <pre><code>dfx identity use &lt;dfx-identity-name&gt;\ndfx identity get-principal\n</code></pre> </li> <li> <p>Check the current balance for the principal</p> <pre><code>dfx ledger --network ic balance\n</code></pre> <p>If you have less than 2 Trillion Cycles (TC) worth of ICP, based on the current ICP value, you can top up the ICP balance by sending funds to the principal, e.g., from https://ic0.app/wallet/.</p> <p>1 TC is the same as 1 XDR (it's a stable currency), which is approximately 1 USD. Canister creation itself will cost 1 TC, and you will need some cycles more to execute commands.</p> </li> <li> <p>Create the wallet canister, after that you will get the wallet canister id in the output.</p> <pre><code>dfx ledger --network ic create-canister --amount 0.5 &lt;principal-from-step-2&gt;\n</code></pre> <p>You may need to adjust the amount of ICPs if needed, based on the current ICP value. More info can be found in the IC SDK Docs.</p> </li> <li> <p>Deploy the wallet canister code</p> <pre><code>dfx identity --network ic deploy-wallet &lt;wallet-canister-id-from-step-4&gt;\n</code></pre> </li> </ol>"},{"location":"trustworthy-metrics/trustworthy-metrics.html#using-the-cli","title":"Using the cli","text":"<p>You can obtain the DRE tool by following getting started</p> <p>To test out the command you can run the following command</p> <pre><code>dre &lt;key-params&gt; trustworthy-metrics &lt;wallet-canister-id&gt; &lt;start-at-timestamp&gt; [&lt;subnet-id&gt;...]\n</code></pre> <p>Arguments explanation:</p> <ol> <li><code>wallet-canister-id</code> - id of the created wallet canister created in the step 4 above</li> <li><code>start-at-timestamp</code> - used for filtering the output. To get all metrics, provide 0</li> <li><code>subnet-id</code> - subnets to query, if empty will provide metrics for all subnets</li> <li><code>key-params</code> - depending on which identity you used to deploy the wallet canister you have two options:</li> </ol> <p>If you used a purely new identity (which is advised since the tool can then parallelise the querying) you have to:</p> <ol> <li> <p>export identity as <code>.pem</code> file which you can do as follows:</p> <pre><code>dfx identity export &lt;identity-name&gt; &gt; identity.pem\n</code></pre> </li> <li> <p>replace <code>&lt;key-params&gt;</code> in the command with something like: <code>--private-key-pem identity.pem</code></p> </li> </ol> <p>If you used an HSM then replace <code>&lt;key-params&gt;</code> with: <code>-hsm-slot 0 --hsm-key-id 0 --hsm-pin $(cat &lt;pin-file&gt;)</code>. Note that the HSM is less parallel than the key file due to hardware limits, so getting metrics with an HSM will be a bit slower.</p> <p>Even if created the wallet canister with an HSM you can still add another file-based controller to the wallet canister:</p> <ol> <li> <p>Get the principal of new identity</p> <pre><code>dfx identity use &lt;identity-name&gt; &amp;&amp; dfx identity get-principal\n</code></pre> </li> <li> <p>Add the identity as the controller of canister</p> <pre><code>dfx identity use &lt;identity-name-used-for-creating-canister&gt;\ndfx wallet --network ic add-controller &lt;principal&gt;\n</code></pre> </li> <li> <p>Use the newly created identity while running the tool.</p> </li> </ol>"},{"location":"trustworthy-metrics/trustworthy-metrics.html#example-use","title":"Example use","text":"<p>Here are some real-world examples of how metrics can be retrieved:</p> <pre><code>dre --private-key-pem identity.pem trustworthy-metrics nanx4-baaaa-aaaap-qb4sq-cai 0 &gt; data.json\n</code></pre> <p>Or with an HSM: <pre><code>dre --private-key-pem identity.pem trustworthy-metrics nanx4-baaaa-aaaap-qb4sq-cai 0 &gt; data.json\n</code></pre></p> <p>You can check some examples of the analytics possible with the IC Mainnet data in the following Jupyter Notebook If you don't have Jupyter notebooks locally, you can use  to run it online.</p>"}]}